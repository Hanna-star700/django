{% extends 'base.html' %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É{% endblock %}

{% block content %}
<div class="results-container" id="resultsApp">
    <div class="results-header">
        <div class="results-badge">
            <span class="badge-icon">üìä</span>
            <span>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É</span>
        </div>
        <h1 id="resultTitle">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h1>
        <p class="results-description">–û—Ç—Ä–∏–º–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è</p>
    </div>

    <div class="score-section">
        <div class="score-circle" id="scoreCircle" style="--percentage: 0deg;">
            <div class="score-text" id="scoreText">0%</div>
        </div>
        <div class="score-details">
            <h2 id="scoreDetails">0 –∑ 0 –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</h2>
            <div class="score-level" id="scoreLevel">
                <span class="level-icon">üéØ</span>
                <span class="level-text">–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å</span>
            </div>
        </div>
    </div>

    <div class="recommendations-section">
        <h3>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h3>
        <div class="recommendations" id="reco">
            <div class="recommendation-item">
                <span class="rec-icon">üìö</span>
                <span class="rec-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π...</span>
            </div>
        </div>
    </div>

    <div class="recommendations-section" id="topicsSection" style="display:none;">
        <h3>–¢–µ–º–∏, —è–∫—ñ –≤–∞—Ä—Ç–æ –ø—ñ–¥—ñ–≤—á–∏—Ç–∏</h3>
        <div class="recommendations" id="topicsList"></div>
    </div>

    <div class="next-steps">
        <h3>–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏</h3>
        <div class="steps-grid">
            <div class="step-card">
                <div class="step-icon">üé•</div>
                <h4>–í—ñ–¥–µ–æ —É—Ä–æ–∫–∏</h4>
                <p>–î–∏–≤—ñ—Ç—å—Å—è —è–∫—ñ—Å–Ω—ñ –≤—ñ–¥–µ–æ –∑ YouTube –¥–ª—è –ø–æ—Å—Ç—É–ø–æ–≤–æ–≥–æ –≤–∏–≤—á–µ–Ω–Ω—è –æ—Å–Ω–æ–≤ Python</p>
            </div>
            <div class="step-card">
                <div class="step-icon">üìù</div>
                <h4>–ü—Ä–∞–∫—Ç–∏–∫–∞</h4>
                <p>–í–∏–∫–æ–Ω—É–π—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –∑–∞–∫—Ä—ñ–ø–ª—é–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω—ñ –∑–Ω–∞–Ω–Ω—è</p>
            </div>
            <div class="step-card">
                <div class="step-icon">üîÑ</div>
                <h4>–ü–æ–≤—Ç–æ—Ä–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h4>
                <p>–ü—Ä–æ–π–¥—ñ—Ç—å —Ç–µ—Å—Ç –∑–Ω–æ–≤—É –ø—ñ—Å–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å</p>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="/" class="btn btn-secondary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            –ù–∞ –≥–æ–ª–æ–≤–Ω—É
        </a>
        {% if user.is_authenticated %}
            <a href="{% url 'video_lessons' %}" class="btn btn-primary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M19 10a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –≤—ñ–¥–µ–æ —É—Ä–æ–∫—ñ–≤
            </a>
        {% else %}
            <a href="{% url 'register' %}" class="btn btn-primary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è –Ω–∞ –∫—É—Ä—Å–∏
            </a>
        {% endif %}
        <a href="{% url 'quiz' %}" class="btn btn-outline">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            –ü—Ä–æ–π—Ç–∏ –∑–Ω–æ–≤—É
        </a>
    </div>
</div>

<script>
(function() {
    const raw = sessionStorage.getItem('quiz_result');
    if (!raw) {
        // Redirect to quiz if no results
        window.location.href = '{% url "quiz" %}';
        return;
    }
    
    try {
        const data = JSON.parse(raw);
        const { name = '–ì—ñ—Å—Ç—å', score = 0, total = 0, percentage = 0, recommendations = '', achievement = '', topics = [] } = data;
        const deg = Math.round(percentage / 100 * 360);
        
        // Update score circle
        document.getElementById('scoreCircle').style.setProperty('--percentage', deg + 'deg');
        document.getElementById('scoreText').textContent = Math.round(percentage) + '%';
        document.getElementById('scoreDetails').textContent = `${score} –∑ ${total} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π`;
        document.getElementById('resultTitle').textContent = `${name}, –≤–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç`;
        
        // Update level based on percentage
        const levelElement = document.getElementById('scoreLevel');
        const levelIcon = levelElement.querySelector('.level-icon');
        const levelText = levelElement.querySelector('.level-text');
        
        if (percentage >= 80) {
            levelIcon.textContent = 'üèÜ';
            levelText.textContent = achievement || '–ï–∫—Å–ø–µ—Ä—Ç';
            levelElement.className = 'score-level expert';
        } else if (percentage >= 60) {
            levelIcon.textContent = '‚≠ê';
            levelText.textContent = achievement || '–†–æ–∑—É–º–Ω–∏–π';
            levelElement.className = 'score-level advanced';
        } else if (percentage >= 40) {
            levelIcon.textContent = 'üìà';
            levelText.textContent = achievement || '–°–µ—Ä–µ–¥–Ω—ñ–π';
            levelElement.className = 'score-level intermediate';
        } else {
            levelIcon.textContent = 'üå±';
            levelText.textContent = achievement || '–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å';
            levelElement.className = 'score-level beginner';
        }
        
        // Update recommendations
        const recommendationsElement = document.getElementById('reco');
        recommendationsElement.innerHTML = `
            <div class="recommendation-item">
                <span class="rec-icon">üí°</span>
                <span class="rec-text">${recommendations}</span>
            </div>
        `;

        // Topics to review
        if (Array.isArray(topics) && topics.length) {
            document.getElementById('topicsSection').style.display = '';
            document.getElementById('topicsList').innerHTML = topics.map(t => `
                <div class="recommendation-item">
                    <span class="rec-icon">üìå</span>
                    <span class="rec-text">${t}</span>
                </div>
            `).join('');
        }
        
        // Add animation delay for better UX
        setTimeout(() => {
            document.getElementById('scoreCircle').style.animation = 'scoreAnimation 1s ease-out';
        }, 500);
        
    } catch (e) {
        console.error('Error parsing quiz results:', e);
        window.location.href = '{% url "quiz" %}';
    }
})();
</script>
{% endblock %}

