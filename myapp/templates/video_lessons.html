{% extends 'base.html' %}

{% block title %}–í—ñ–¥–µ–æ —É—Ä–æ–∫–∏{% endblock %}

{% block content %}
<div class="video-lessons-container">
    <div class="video-header">
        <div class="video-badge">
            <span class="badge-icon">üé•</span>
            <span>–í—ñ–¥–µ–æ —É—Ä–æ–∫–∏ Python</span>
        </div>
        <h1>–í–∞—à —à–ª—è—Ö –¥–æ –≤–∏–≤—á–µ–Ω–Ω—è Python</h1>
        <p class="video-description">–ü–æ—á–Ω—ñ—Ç—å –∑ –ø–µ—Ä—à–∏—Ö –¥–≤–æ—Ö –≤—ñ–¥–µ–æ, –∞ –¥–∞–ª—ñ –ø–æ–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—å –¥–æ –≤—Å—Ç—É–ø–Ω–æ–≥–æ —Ç–µ—Å—Ç—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—É</p>
    </div>

    <div class="learning-path">
        <h3>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –Ω–∞–≤—á–∞–Ω–Ω—è</h3>
        <div class="path-steps">
            <div class="path-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>–î–∏–≤—ñ—Ç—å—Å—è –≤—ñ–¥–µ–æ —É—Ä–æ–∫–∏</h4>
                    <p>–ü–æ—á–Ω—ñ—Ç—å –∑ –æ—Å–Ω–æ–≤ Python —Ç–∞ –ø–æ—Å—Ç—É–ø–æ–≤–æ –ø–µ—Ä–µ—Ö–æ–¥—å—Ç–µ –¥–æ —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö —Ç–µ–º</p>
                </div>
            </div>
            <div class="path-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—è</h4>
                    <p>–ü–æ–≤—Ç–æ—Ä—é–π—Ç–µ –∫–æ–¥ –∑ –≤—ñ–¥–µ–æ —Ç–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É–π—Ç–µ –∑ –Ω–æ–≤–∏–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—è–º–∏</p>
                </div>
            </div>
            <div class="path-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å</h4>
                    <p>–ü—Ä–æ–π–¥—ñ—Ç—å –≤—Å—Ç—É–ø–Ω–∏–π —Ç–µ—Å—Ç –∑–Ω–æ–≤—É, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å</p>
                </div>
            </div>
        </div>
    </div>

    <div class="video-grid" id="videoGrid">
        {% for v in lessons %}
        <div class="video-card" data-youtube="{{ v.youtube_url }}">
            <div class="video-thumbnail">
                <div class="play-button">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                        <path d="M8 5v14l11-7z" fill="currentColor"/>
                    </svg>
                </div>
                <div class="video-overlay">
                    <span class="duration">{{ v.duration }}</span>
                </div>
            </div>
            <div class="video-info">
                <div class="video-title">{{ v.title }}</div>
                <div class="video-description">{{ v.description }}</div>
                <div class="video-meta">
                    <span class="lesson-number">–£—Ä–æ–∫ {{ v.order }}</span>
                    <span class="video-type">YouTube</span>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="empty-videos">
            <div class="empty-icon">üé•</div>
            <h3>–ù–µ–º–∞—î –≤—ñ–¥–µ–æ —É—Ä–æ–∫—ñ–≤</h3>
            <p>{% if user.is_staff %}–î–æ–¥–∞–π—Ç–µ –≤—ñ–¥–µ–æ —É—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è –ø–æ—á–∞—Ç–∫—É –Ω–∞–≤—á–∞–Ω–Ω—è.{% else %}–í—ñ–¥–µ–æ —É—Ä–æ–∫–∏ –Ω–µ–∑–∞–±–∞—Ä–æ–º –∑'—è–≤–ª—è—Ç—å—Å—è. –ü–æ–∫–∏ —â–æ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç!{% endif %}</p>
            {% if user.is_staff %}
            <a href="/admin/" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∞–¥–º—ñ–Ω–∫–∏</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div class="video-actions">
        <a href="{% url 'quiz' %}" class="btn btn-primary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M9 12l2 2 4-4M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            –ü—Ä–æ–π—Ç–∏ –≤—Å—Ç—É–ø–Ω–∏–π —Ç–µ—Å—Ç
        </a>
        <a href="/" class="btn btn-secondary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            –ù–∞ –≥–æ–ª–æ–≤–Ω—É
        </a>
    </div>
</div>

<script>
(function() {
    const cards = document.querySelectorAll('.video-card');
    cards.forEach(card => {
        const url = card.getAttribute('data-youtube');
        if (!url) return;
        
        let embed = url;
        try {
            // Handle common YouTube formats
            if (embed.includes('watch?v=')) {
                const id = embed.split('watch?v=')[1].split('&')[0];
                embed = 'https://www.youtube.com/embed/' + id;
            } else if (embed.includes('youtu.be/')) {
                const id = embed.split('youtu.be/')[1].split('?')[0];
                embed = 'https://www.youtube.com/embed/' + id;
            }
        } catch (e) {
            console.error('Error parsing YouTube URL:', e);
            return;
        }

        // Create modal for video playback
        card.addEventListener('click', () => {
            const modal = document.createElement('div');
            modal.className = 'video-modal';
            modal.innerHTML = `
                <div class="modal-overlay">
                    <div class="modal-content">
                        <button class="modal-close">&times;</button>
                        <iframe 
                            width="100%" 
                            height="400" 
                            src="${embed}" 
                            title="YouTube video player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal functionality
            const closeBtn = modal.querySelector('.modal-close');
            const overlay = modal.querySelector('.modal-overlay');
            
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(modal);
                }
            });
            
            // Close on Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(modal);
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
        });
    });
})();
</script>
{% endblock %}

